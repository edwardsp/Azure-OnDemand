{
  "location": "variables.location",
  "resource_group": "variables.resource_group",
  "install_from": "ood",
  "admin_user": "hpcadmin",
  "variables": {
    "image": "OpenLogic:CentOS:7.7:latest",
    "hpc_image": "OpenLogic:CentOS-HPC:7.7:latest",
    "ood_user": "hpcuser",
    "ood_password": "<NOT-SET>",
    "ood_dns_name": "",
    "ood_vm_type": "Standard_D16s_v3",
    "grafana_user": "admin",
    "grafana_pwd": "<NOT-SET>",
    "grafana_vm_type": "Standard_D8s_v3",
    "grafana_dns_name": "",
    "interactive_vm_type": "Standard_D8s_v3",
    "viz_vm_type": "Standard_HB60rs",
    "compute_vm_type": "Standard_HB60rs",
    "interactive_max_instances": 2,
    "viz_max_instances": 2,
    "compute_max_instances": 2,
    "location": "westeurope",
    "resource_group": "<NOT-SET>"
  },
  "vnet": {
    "name": "hpcvnet",
    "address_prefix": "10.2.0.0/20",
    "subnets": {
      "hpc": "10.2.0.0/22"
    }
  },
  "resources": {
    "ood": {
      "type": "vm",
      "public_ip": "true",
      "dns_name": "variables.ood_dns_name",
      "nsg_allow": ["ssh", "http"],
      "vm_type": "variables.ood_vm_type",
      "image": "variables.image",
      "accelerated_networking": "true",
      "managed_identity": {
        "role": "contributor",
        "scope": "resource_group"
      },
      "data_disks": [
        1024,
        1024
      ],
      "storage_sku": "Premium_LRS",
      "subnet": "hpc",
      "tags": [
        "disable-selinux",
        "cndefault",
        "munge",
        "azcli",
        "nfsserver",
        "slurmserver",
        "localuser",
        "add_compute_partition",
        "add_viz_partition",
        "add_interactive_partition",
        "open-ondemand",
        "install-interactive-desktop-deps",
        "install-jupyter-app-deps",
        "install-theia-deps",
        "install-theia",
        "cvmfs"
      ]
    },
    "compute": {
      "type": "slurm_partition",
      "vm_type": "variables.compute_vm_type",
      "instances": "variables.compute_max_instances",
      "availability_set": "compute",
      "image": "variables.hpc_image",
      "subnet": "hpc",
      "tags": [
        "nfsclient",
        "cndefault",
        "localuser",
        "munge",
        "slurmclient",
        "disable-selinux",
        "cvmfs"
      ]
    },
    "interactive": {
      "type": "slurm_partition",
      "vm_type": "variables.interactive_vm_type",
      "instances": "variables.instances",
      "image": "variables.image",
      "subnet": "hpc",
      "tags": [
        "nfsclient",
        "cndefault",
        "localuser",
        "munge",
        "slurmclient",
        "disable-selinux",
        "install-jupyter-app-deps",
        "install-theia-deps",
        "cvmfs"
      ]
    },
    "viz": {
      "type": "slurm_partition",
      "vm_type": "variables.viz_vm_type",
      "instances": "variables.viz_max_instances",
      "availability_set": "compute",
      "image": "variables.hpc_image",
      "subnet": "hpc",
      "tags": [
        "nfsclient",
        "cndefault",
        "localuser",
        "munge",
        "slurmclient",
        "disable-selinux",
        "install-interactive-desktop-deps",
        "cvmfs"
      ]
    },
    "monitor": {
      "type": "vm",
      "public_ip": "true",
      "dns_name": "variables.grafana_dns_name",
      "nsg_allow": ["ssh", "https", "3000"],
      "vm_type": "variables.grafana_vm_type",
      "image": "variables.image",
      "accelerated_networking": "true",
      "storage_sku": "Premium_LRS",
      "subnet": "hpc",
      "tags": [
        "install-grafana"
      ]
    }
  },
  "install": [
    {
      "script": "disable-selinux.sh",
      "tag": "disable-selinux",
      "sudo": true
    },
    {
      "script": "cndefault.sh",
      "tag": "cndefault",
      "sudo": true
    },
    {
      "script": "install-azcli.sh",
      "tag": "azcli",
      "sudo": true
    },
    {
      "script": "nfsserver.sh",
      "tag": "nfsserver",
      "sudo": true
    },
    {
      "script": "nfsclient.sh",
      "args": [
        "ood"
      ],
      "tag": "nfsclient",
      "sudo": true
    },
    {
      "script": "localuser.sh",
      "args": [
        "ood"
      ],
      "tag": "localuser",
      "sudo": true
    },
    {
      "script": "munge.sh",
      "tag": "munge",
      "args": [
        "abcdefghijklmnopqrstuvwxyz123456"
      ],
      "sudo": true
    },
    {
      "script": "slurmctl.sh",
      "tag": "slurmserver",
      "deps": [
        "suspend.sh",
        "resume.sh",
        "hpcadmin_id_rsa",
        "hpcadmin_id_rsa.pub",
        "config.json"
      ],
      "sudo": true
    },
    {
      "script": "slurmpartition.sh",
      "tag": "add_compute_partition",
      "args": [
        "compute",
        "variables.compute_max_instances",
        "variables.compute_vm_type",
        "variables.location"
      ],
      "sudo": true
    },
    {
      "script": "slurmpartition.sh",
      "tag": "add_viz_partition",
      "args": [
        "viz",
        "variables.viz_max_instances",
        "variables.viz_vm_type",
        "variables.location"
      ],
      "sudo": true
    },
    {
      "script": "slurmpartition.sh",
      "tag": "add_interactive_partition",
      "args": [
        "interactive",
        "variables.interactive_max_instances",
        "variables.interactive_vm_type",
        "variables.location"
      ],
      "sudo": true
    },
    {
      "script": "install-interactive-desktop-deps.sh",
      "tag": "install-interactive-desktop-deps",
      "sudo": true
    },
    {
      "script": "install-jupyter-app-deps.sh",
      "tag": "install-jupyter-app-deps",
      "sudo": true
    },
    {
      "script": "install-theia-deps.sh",
      "tag": "install-theia-deps",
      "sudo": true
    },
    {
      "script": "install-theia.sh",
      "tag": "install-theia"
    },
    {
      "script": "install-open-ondemand.sh",
      "tag": "open-ondemand",
      "sudo": true,
      "args": [
        "variables.ood_user",
        "variables.ood_password"
      ]
    },
    {
      "script": "slurmd.sh",
      "tag": "slurmclient",
      "sudo": true
    },
    {
      "script": "cvmfs-azure.demo.sh",
      "tag": "cvmfs",
      "sudo": true
    },
    {
      "script": "install-grafana.sh",
      "tag": "install-grafana",
      "deps": [
        "telegraf_dashboard.json"
      ],
      "sudo": true,
      "args": [
        "variables.grafana_user",
        "variables.grafana_pwd"
      ]
    }
  ]
}
